<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Course Notes</title>
  <link rel="stylesheet" href="course-note.css" />
</head>
<body>
  <header>
    <div class="container">
      <h1>Course Notes</h1>
      <p class="subheading">I hope this helps you in your journey ðŸŒ±</p>
    </div>
  </header>

  <main class="container">
    <section class="courses">
      <h2>Available Courses</h2>

      <div class="search-container">
        <label for="search" class="visually-hidden">Search Courses</label>
        <input type="text" id="search" placeholder="Search Courses..." />
      </div>
      
       <form id="noteForm" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Title" required>
        <textarea name="description" placeholder="Description" required></textarea>

      <div class="sort-container">
        <select id="course-sort" aria-label="Sort by category">
          <option value="" selected disabled>Choose a category</option>
          <option value="CS">CS</option>
          <option value="NE">NE</option>
          <option value="IS">IS</option>
          <option value="CY">CY</option>
          <option value="CE">CE</option>
          <option value="ANOTHER">Another</option>
        </select>

        <input type="hidden" name="type" id="noteType" />


         <div id="pdf-upload" style="display: none;">
          <label>Upload PDF:</label>
          <input type="file" name="file_path_pdf" accept="application/pdf" />
        </div>

        <div id="link-input" style="display: none;">
          <label>Link URL:</label>
          <input type="url" name="file_path_link" placeholder="https://example.com" />
        </div>

        <br><br>
        <button type="submit" class="btn">Submit</button>
      </form>

        <label for="itemType">Add new item:</label>
        <select id="itemType">
          <option value="">-- Choose type --</option>
          <option value="pdf">PDF</option>
          <option value="link">Link</option>
        </select>

        <button id="addButton">Add</button>
      </div>

      <div id="course-grid" class="course-grid"></div>
      <div id="pagination" class="pagination"></div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>Made by Noora Sami &copy; 2025</p>
    </div>
  </footer>
    <script>
    const courseGrid = document.getElementById("course-grid");
    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("course-sort");
    const paginationDiv = document.getElementById("pagination");

    let courses = [];
    let filteredCourses = [];
    let currentPage = 1;
    const itemsPerPage = 5;

      function displayCourses() {
      courseGrid.innerHTML = "";
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const currentItems = filteredCourses.slice(start, end);

      if (currentItems.length === 0) {
        courseGrid.innerHTML = "<p class='error'>No courses found.</p>";
        return;
      }

    fetch("https://3aa7faeb-f0f7-4ea7-98b7-1eb9cc448768-00-29unw5ntf5qlw.pike.replit.dev/get.php?module=course-note")
  .then((response) => {
    if (!response.ok) {
      throw new Error("Failed to fetch course notes");
    }
    return response.json();
  })
  .then((data) => {
    if (data.status !== "success") {
      courseGrid.innerHTML = "<p class='error'>Failed to load courses.</p>";
      return;
    }

    courses = data.data;
    filteredCourses = [...courses];

    displayCourses();
    setupPagination();
  })
  .catch((error) => {
    console.error("Fetch error:", error);
    courseGrid.innerHTML = "<p class='error'>Connection error.</p>";
  });
  currentItems.forEach(course => {
        const div = document.createElement("div");
        div.className = "course-card";
        div.innerHTML = `
          <h3>${course.title}</h3>
          <p>${course.description.slice(0, 80)}...</p>
          <a href="view-note.php?id=${course.id}" class="btn">View Notes</a>
        `;
        courseGrid.appendChild(div);
      });
    }

    searchInput.addEventListener("input", function () {
      const searchValue = this.value.toLowerCase();
      filteredCourses = courses.filter(course =>
        course.title.toLowerCase().includes(searchValue)
      );
      currentPage = 1;
      displayCourses();
      setupPagination();
    });

    sortSelect.addEventListener("change", function () {
      const selectedCategory = this.value;
      filteredCourses = courses.filter(course => course.category === selectedCategory);
      currentPage = 1;
      displayCourses();
      setupPagination();
    });

    function setupPagination() {
      paginationDiv.innerHTML = "";
      const totalPages = Math.ceil(filteredCourses.length / itemsPerPage);
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.innerText = i;
        if (i === currentPage) {
          btn.style.fontWeight = "bold";
        }
        btn.addEventListener("click", function () {
          currentPage = i;
          displayCourses();
        });
        paginationDiv.appendChild(btn);
      }
    }

    document.getElementById("addButton").addEventListener("click", () => {
  const type = document.getElementById("itemType").value;
  if (type === "pdf" || type === "link") {
    window.location.href = `upload.php?type=${type}`;
  } else {
    alert("Please choose a type (PDF or Link) before clicking Add.");
  }
});

const urlParams = new URLSearchParams(window.location.search);
const type = urlParams.get("type");

if (type === "pdf" || type === "link") {
  document.getElementById("noteType").value = type;

  if (type === "pdf") {
    document.getElementById("pdf-upload").style.display = "block";
    document.querySelector('input[name="file_path_pdf"]').required = true;
  } else {
    document.getElementById("link-input").style.display = "block";
    document.querySelector('input[name="file_path_link"]').required = true;
  }
} else {
  alert("Invalid or missing type.");
  window.location.href = "index.php";
}



    fetchCourses();
  </script>
</body>
</html>
